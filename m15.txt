M15 Release Notes
Milestone M15
Released on 13-Jan-2023.

For a complete overview of the issues and merge requests, please refer here.

For detailed services that are included in this release, please refer to M15 tagging notes.

❗ Important Note
In keeping with our policy of releasing new capabilities early and often for feedback, we are pleased to introduce several new experimental/early release platform capabilities in this milestone release. These are currently only available in specific cloud service providers with limited scopes and functionalities, future milestone release will include more CSP support. Please refer to the details below.

Policy service (Experimental/Early Release) - AWS, Azure, IBM, GCP
GCP Performance issue is noted during preship testing, Policy service is OFF by default.
AWS Policy service is ON by default.
Azure Policy service is ON by default.
IBM Policy service is OFF by default.
Reservoir DDMS (Experimental/Early Release) - Azure, IBM
External Data Services (Experimental/Early Release) - Azure, GCP
Geospatial Consumption Zone (Experimental/Early Release) - IBM, AWS (Developer/Local only)
Manifest ingestion by reference (Experimental/Early Release) - GCP, IBM, AWS
Table of Content
Milestone M15
❗ Important Note
Table of Content
New Features
Data Definition
Core and Helper Services
Ingestion services
DDMS
External Data Services (EDS)
GCZ (Geospatial Consumption Zone)
Bug Fixes
Core and Helper Services
Ingestion services
DDMS
External Data Services (EDS)
GCZ (Geospatial Consumption Zone)
❗ Breaking Changes
DDMS
GCZ (Geospatial Consumption Zone)
Known Issues/Gaps
GCZ (Geospatial Consumption Zone)
External Data Service
Known Issues/Gaps
Supporting Information
OSDU Community utilities
New Features
Data Definition
Attention: Please use tag v0.18.1 or release/0.18 because tag v0.18.0 contains one OperationsReport.1.2.0 schema resource, which fails to register. The patch v0.18.1 corrects this mistake.

No in-place schema changes are required in M15 (no M14 schema resources were changes). Refer here for full changes "OSDU schemas" and full changes "OSDU reference-values"

New Entity Types
Seismic Domain: New template reference data type SEGY-HeaderMappingTemplate:1.0.0 to support SEG-Y parsing assistance in particular for Revision 0 files. Worked examples here.
Schema Upgrade Support: In preparation for the Schema Upgrade Service, Data Definitions provided the resources in form of reference data records (as manifest) for
SchemaUpgradeSpecification:1.0.0 containing JOLT specifications, which can be augmented by platform operators. Worked examples here.
SchemaUpgradeChain:1.0.0 declaring upgrade candidates for target schema versions. Worked examples here.
ReferenceValueUpgradeLookUp:1.0.0 - a similar reference data structure for to supersede deprecated reference values. Also here, platform owners can control what reference value upgrades are executed (provided the Schema Upgrade Service delivers the capability). Worked examples here.
Incremental Entity Versions
Connected Data Sources: ConnectedSourceDataJob:1.2.0 with additional properties.
"CreateTimeMax" a new attribute - to control the incremental fetch records from the data provider
"FailedRecords" existing attribute, but a change in the format
“OnIngestionSchemaAuthority” to control "kind" of created record from fetch-and-ingest at target (Operator)
Well Delivery
OperationsReport:1.2.0 correcting some property types, see details.
HoleSection:1.1.0: now with individual zero depth point.
Wellbore:1.2.0 now carries a LaheeClassID property superseding the DrillingReasonTypeID. PPDM delivered the reference values
Facilities now offer Remark strings for facility events, operators and states. This causes minor, incremental versions for Rig:1.1.0, StorageFacility:1.1.0, Well:1.2.0 and Wellbore:1.2.0.
Seismic Domain:
AbstractBinGrid has been revised to disambiguate the usage. It is now recommended to associate the inline/crossline numbers and ABCD labels with the ABCDBinGridSpatialLocation (using the AbstractAnyCrsFeatureCollection:1.1.0 structure with a declared schema fragment for the properties in AbstractGeoJson.PropertiesBinGridCorners). This is linked to the CRS Converter convertBinGrid enhancement.
PPDM Reference Value Updates
BitType:1.0.1 one more superseded definition.
SeismicEnergySourceType:1.0.1 now with PPDM governance.
VerticalMeasurementPath:1.0.1 now with PPDM governance.
Split of AdditiveType into AdditiveType and AdditiveRole:
New AdditiveRole:1.0.0
AdditiveType:1.0.1 deprecating the values, which are really AdditiveRole values.
Deprecation of DrillingReasonType:1.0.0, whose values are replaced by:
LaheeClass:1.0.0
Corrections
The content of TubularAssemblyType was by accident replicated in TubularAssenblyStatusType. The content has been corrected for TubularAssemblyStatusType:1.0.0.
Core and Helper Services
Indexer
Info api implementation for adding outerservice version in response. See MR !424
Storage
Include collaboration context when pushing to new record changed topic. See MR !553
Update Storage to be Collaboration Context Aware. See MR !546
Changed CRC32C to MD5 to calculate a checksum (GONRG-5884). See MR !542
Added ability to config redis password and ssl (GONRG-5301). See MR !540
ADR 92: Populate recordBlocks in record modification events. See MR !539
File Service
AWS - Now the file checksum is added to the metadata. See ADR and MR !383
Schema
OSDU-DD-Delivery-M15 (v0.18.0). See MR !407
CRS Conversion v3
"Add convertBinGrid endpoint". See MR !235
Policy
Translate, Logging and Correlation ID update. See MR !256, features and minor changes
Lib
Expose Collaboration Context. See MR !183
Add validator to record ancestry to make sure parent record id is valid. See MR !174
Ingestion services
Manifest-based Ingestion - Major performance improvement.
osdu-ingestion-lib - writing records in parallel/concurrent manner into Storage service. See MR
osdu-airflow-lib - Added new Airflow variable core__ingestion__thread_save_number to tune a number of concurrent writings into Storage service for ProcessManifestOperatorR3 operator. This variable is optional (default: 1). See MR
Manifest-based Ingestion - Manifest by reference.
AWS now support ingestion of manifest by reference.
DDMS
Seismic DDMS
Ibm arn change
Update subproject acl options
Use kube dns in azure
Wellbore DDMS
Support of Well 1.2.0 and Wellbore 1.2.0, see !#656
Reservoir DMS
REST API capability to create manifest information from RDMS content at the end of collaboration workflow, allows to provide outside information such as ACL, legal tags and existing dataset reference
Server capability to clone dataspace
External Data Services (EDS)
Enable the end-user to configure schema authority variable at the Operator end
Handle EDS incremental fetch scenario
Provide default date and time to LastSuccessfulRunDateUTC in ConnectedSourceDataRegistry
EDS DMS - Options for Consumer to manage bulk data files (ex: LAS, DLIS, SegY) from Data Provider
GCZ (Geospatial Consumption Zone)
AWS - Experimental - As a developer, you can run the GCZ locally and connect to an OSDU on AWS instance. See GCZ readme.
Ingestion
Transformer now supports limited Ingestion of WellLog records via ID-to-ID spatialization
Example: Store Well Logs to Ignite as Well Surface Locations only with Well Log attributes - then view on a map
Supports any kind where Search results lack geometry but contain clear references to another geometry-containing kind
See our Kind Spatial Source docs for more info
Now supports geometry ingestion from the SpatialArea.Wgs84Coordinates property in addition to the already-supported SpatialLocation.Wgs84Coordinates property.
Persistence
Remote Profile is now compatible with Persistence-Enabled Ignite Clusters
With Persistence Enabled on your Ignite Cluster and your Transformer configured appropriately, utilize Ignite's on-disk storage capabilities.
Testing
Three demo web apps have been added to the new osdu_gcz_test_assets directory for testing purposes
Easily observe data served from the Provider on a map using three different workflows:
esri_jsapi_test.html - ArcGIS JavaScript API + Provider Endpoint
leaflet_esri_test.html - Open Source Leaflet JS Library + Esri Plugin + Provider Endpoint
leaflet_geojson_test.html - Open Source Leaflet JS Library + Provider Endpoint using GeoJSON spec output
Just plugin your Provider Feature Layer Endpoints where indicated in each file before opening in the browser
Unit Tests refactored to reduce redundant code duplication
Special thanks to Xiangliang Meng from AWS for authoring those refactors
New Provider endpoint created to expose koop-config.json to help users understand how the GCZ has configured its layer definitions - try it out in our updated Postman Collection in the Provider Metadata folder - "Get Layer Definitions" request
{{PROVIDER_URL}}/FeatureServer/layers/info
Postman Collection has been reworked
Uses collection variables for easy plugin-and-test workflow
Simply plugin PROVIDER_URL and AMBASSADOR_URL
Now covers more test cases and more request parameters
Includes examples on Ambassador endpoints and the new layer definitions endpoint
Environment Support
Now supports a Kubernetes Profile for deploying/running GCZ components within a Kubernetes Cluster
See updated documentation for the breakdown on configuring and running the K8S Remote Profile.
Special thanks to the folks at IBM for building out this solution: Bhushan Rade, Shrikant Garg, and Anuj Gupta
New deployment documentation added specifically for AWS integration. Find here.
Special thanks to Morris Estepa from AWS for authoring the AWS Deployment Docs
Ambassador
Admin endpoint now supports manual cache updates via the /gcz/transformer/admin/updateCache endpoint
Before, cache updates could only occur on the predefined schedule. Now, cache updates can be initiated at any time via the endpoint.
Auth support for admin endpoint is in-development
Build
mvn clean install now skips unit tests by default. No need to run mvn clean install -dSkipTests=true for a typical build.
Build docs have been updated to reflect this change
Auth
clientID and clientSecret can now be referenced via environmental variables in the application YAML files. No additional configuration required, simply input the name of the environmental variable for each respective property, and the Transformer will automatically scan the environment for that variable. Otherwise, the Transformer will read the values explicitly:

    clientID: GCZ_CLIENT_ID_ENV_VARIABLE
    clientSecret: GCZ_CLIENT_SECRET_ENV_VARIABLE
Docs
Updated with new info on:
Kubernetes Deployment
Ambassador Endpoints (cacheSize and updateCache)
Provider layer query parameters (f for specifying geojson spec output)
How to leverage YAML configuration files that live outside of the project directory
Webapp demos
And more...
koop-config.json - The default fields for our Seismic 3D layer have been expanded from 1 field to 9 fields
Logs
Ingestion stats now summarized per-kind / per-day, as dataIngestionError.log files within the target/logs directory. Example:

2022-12-13 15:52:54.537 - Cannot create feature with id: `osdu:master-data--SeismicAcquisitionSurvey:ZMTest' from kind: 'osdu:wks:master-data--SeismicAcquisitionSurvey:1.0.0'
2022-12-13 15:52:54.540 - Cannot create feature with id: `osdu:master-data--SeismicAcquisitionSurvey:ST0202R08' from kind: 'osdu:wks:master-data--SeismicAcquisitionSurvey:1.0.0'
2022-12-13 15:52:54.541 - Could not process 2 features from kind: 'osdu:wks:master-data--SeismicAcquisitionSurvey:1.0.0' due to invalid geometries
2022-12-13 15:52:54.778 - 

######## Local profile - Cache Load Summary for kind osdu:wks:master-data--SeismicAcquisitionSurvey:1.0.0 ######## 
5 records for kind osdu:wks:master-data--SeismicAcquisitionSurvey:1.0.0 found. 3 succeeded. 2 had errors.
########################################################################################

2022-12-13 15:52:55.708 - 

######## Local profile - Cache Load Summary for kind osdu:wks:work-product-component--SeismicLineGeometry:1.0.0 ######## 
4 records for kind osdu:wks:work-product-component--SeismicLineGeometry:1.0.0 found. 4 succeeded. 0 had errors.
########################################################################################
App logs generally improved for clarity

Miscellaneous
Provider
The configuration property igniteTable has been omitted from both the documentation and our example config file as it is no longer necessary
Transformer
Class names have been updated in the code to give more clarity to applicable profiles:
New class names: FeatureCacheLocalSynchronizer, FeatureCacheRemoteSynchronizer
Bug Fixes
Core and Helper Services
Storage
Bug Fix for Azure: update the message to not be sent to recordstopic v2 if feature flag is off. See MR !582
Added spring-boot-maven plugin version. See MR !560
Removing the azure message bus message id. See MR !550
Storage Performance (GONRG-4754). See MR !535
Delete all versions of the blob when purging a record. See MR !534
Consume latest version of core common library and update the way of getting parent records. See MR !532
CRS Catalog
Jar type vulnerability fix for catalog service. See MR !220
Unit
Unit Service vulnerability fix. See MR !222
Squashed commit of the following. See MR !216
Dataset
Aws integration merge. See MR !276
Register
White source updates. See MR !262
Schema
Fix spring-boot-maven plugin version. See MR !412
Indexer
Fix spring-boot-maven-plugin. See MR !421
Whitesource-update. See MR !412
Removed retry attempts and call to storage service. See MR !384
Search
Added spring-boot-maven plugin version. See MR !375
Parse-query changes. See MR !372
Partition
Update vulnerable dependencies. See MR !285
File
Bypass checksum generation for file size more than 5 gbs. See MR !368
Entitlements
Added spring-boot-maven plugin version. See MR !382
Legal
Added spring-boot-maven plugin version. See MR !324
Update vulnerable dependencies. See MR !315
Policy
Test ibm bucket. See MR !253 and fixed bugs
Ingestion services
Lib
Upgrade lombok version to fix ingestion request deserialization. See MR !329
Trusted development. See MR !147
Trusted development. See MR !143
Fix Vulnerabilities. See MR !12
Segy to Zgy Conversion
Fix: segy_configure_remote_access to set http headers. See MR !163
DDMS
Seismic DDMS
Increase express json body size limit
Handle Azure DNS zone endpoints
Fixed the ls pagination endpoint to return the nexPageToken in case the data set result is empty
General bug fixes & stability improvement. Refer to service, sdapi, and sdutil for detailed notes
Wellbore DDMS
AWS - Fixed performance issues for reading wellbore ddms data. See Issue
lib updates: fastAPI 0.70, Dask 2022.10.2, ffspec and implementations (adfs, s3fs, gcfs ...), PyArrow 9.0.0.
Azure lib: retry mechanism to work around ClientAuthentication issues to blob storage (see changes, imported by !659).
Reservoir DMS
Fixes around entitlement and group management
External Data Services (EDS)
EDS-Ingest - show in the Airflow log the exact body of the query being executed to bring data from the source
Fetch query does not respect wildcard syntax
Corrected Airflow Xcom summary from Ingest task
GCZ (Geospatial Consumption Zone)
Transformer
Fix batchSize config option not respected when below 1000
Provider
Fix Provider crashing that occurred when spatial intersections were attempted on a Feature Layer using an esriGeometryPoint or invalid geometry
Fix Provider not responding to manual spatial queries when using WKT representation of geometry
❗ Breaking Changes
DDMS
Wellbore DDMS
API POST /ddms/v3/records/delete is deprecated, see OpenAPI spec. Consumers should use either the typed delete APIs from WDMS (e.g. DELETE /ddms/v3/wells/{wellid}) or the core storage service delete API.
GCZ (Geospatial Consumption Zone)
Configuration file name change
application.yml has been renamed to application-local.yml
Ignite Cache Name
We now require a separate identifying string for the name of a cache, as configured in either application-local.yml, application-remote.yml, or application-k8s-remote.yml
Each kind previously needed to contain the name and chronExpr properties, but now must contain a cacheName property
The reason for this change is due to our new support of Persistence-Enabled Ignite Clusters, which strictly impose that cache names do not contain special characters such as : due to conflicts with file storage. Please note that taking the kind name and simply replacing all : characters with an underscore \\\\\\\\\\\\\\\_ should work fine, but you are welcome to name your caches however you like, avoiding special characters.
Additionally, you will need to configure koop-config.json to include the cacheName property or else the Provider will be unable to find the cache by kind entity alone.
Known Issues/Gaps
GCZ (Geospatial Consumption Zone)
WellLog support / Spatialization will only pull geometries from the SpatialArea.Wgs84Coordinates or SpatialLocation.Wgs84Coordinates properties from a record gathered via the Search API. By default, this is typically where Well records store their surface locations, and as such, Well Logs can only currently be displayed via the Surface Location of a Well, and not via the bottomhole or midpoint location.
External Data Service
EDS DMS - In the current version EDS DMS can manage bulk data files from one Data Provider only. It will not support a combination of dataset IDs from different data providers.Also, testing can be done using eds-DMS API and not from data set API.

osdu/platform/pre-shipping#436 (closed) Note: This will work fine when one WPC is fetched from the Data Provider.

Known Issues/Gaps
Refer here for a list of known pre-shipping testing issues.
Supporting Information
Preship Testing team's test result summary
Preship Testing team's test result folder . This contains documented steps for using respective features.
QA (aka "Platform Validation") team's folders of Postman Collections
Open Test data - good collection of load manifest (JSON) files matching sample data from TNO, Volve. Here
Data loading guide (quick start). Here
OSDU Community utilities
Repository has been moved and reorganized to reflect the Platform Core Services vs Platform Utilities
